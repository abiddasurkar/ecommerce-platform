const { SitemapStream, streamToPromise } = require('sitemap');
const { Readable } = require('stream');
const { writeFileSync } = require('fs');
const { resolve } = require('path');

async function generateSitemap() {
  try {
    // Define your URLs
    const links = [
      {
        url: '/',
        changefreq: 'weekly',
        priority: 1.0,
        lastmod: new Date().toISOString().split('T')[0]
      },
      {
        url: '/transactions',
        changefreq: 'weekly',
        priority: 0.9,
        lastmod: new Date().toISOString().split('T')[0]
      }
    ];

    // Create a stream to write to
    const stream = new SitemapStream({ 
      hostname: 'https://abiddasurkar.github.io/banking-dashboard' 
    });

    // Return a promise that resolves with your XML string
    const data = await streamToPromise(Readable.from(links).pipe(stream));
    
    // Write to build/sitemap.xml
    const sitemapPath = resolve(__dirname, 'build', 'sitemap.xml');
    writeFileSync(sitemapPath, data.toString());
    
    console.log('✅ Sitemap generated successfully at:', sitemapPath);
  } catch (error) {
    console.error('❌ Error generating sitemap:', error);
    process.exit(1);
  }
}

generateSitemap();